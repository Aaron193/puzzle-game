var T=Object.defineProperty;var H=(r,i,t)=>i in r?T(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var h=(r,i,t)=>(H(r,typeof i!="symbol"?i+"":i,t),t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(e){if(e.ep)return;e.ep=!0;const s=t(e);fetch(e.href,s)}})();const w=class{};let d=w;h(d,"canvas",document.getElementById("game-canvas")),h(d,"ctx",w.canvas.getContext("2d")),h(d,"Colors",{background:"#141414",gridBoarder:"white",cellBoarder:"white",gridFill:"black"});class k{constructor(){h(this,"position");h(this,"isDown");h(this,"onmousedown",()=>{});h(this,"onmouseup",()=>{});h(this,"onmousemove",()=>{});this.position={x:0,y:0},this.isDown=!1,window.addEventListener("mousemove",i=>this.onMouseMove(i)),window.addEventListener("mousedown",i=>this.onMouseDown(i)),window.addEventListener("mouseup",i=>this.onMouseUp(i))}onMouseMove(i){this.position.x=i.clientX,this.position.y=i.clientY,this.onmousemove()}onMouseDown(i){this.position.x=i.clientX,this.position.y=i.clientY,this.isDown=!0,this.onmousedown()}onMouseUp(i){this.position.x=i.clientX,this.position.y=i.clientY,this.isDown=!1,this.onmouseup()}get x(){return this.position.x}get y(){return this.position.y}isMouseDown(){return this.isDown}}class S{constructor(i){h(this,"width");h(this,"height");h(this,"gridSize");h(this,"position");h(this,"grid");const{width:t,height:o,gridSize:e}=i;this.width=t,this.height=o,this.gridSize=e,this.grid=new Array(t*o),this.position={x:d.canvas.width*.5-t*this.gridSize*.5,y:d.canvas.height*.5-o*this.gridSize*.5}}setTile(i,t,o){i=Math.floor(i/this.gridSize),t=Math.floor(t/this.gridSize);const e=i+t*this.width;this.grid[e]=o}getTile(i,t){i=Math.floor(i/this.gridSize),t=Math.floor(t/this.gridSize);const o=i+t*this.width;return this.grid[o]}getTileAtIndex(i){return this.grid[i]}draw(i){i.save(),i.translate(this.position.x,this.position.y),i.save(),i.fillStyle=d.Colors.gridFill,i.beginPath(),i.strokeStyle=d.Colors.gridBoarder,i.lineWidth=15,i.roundRect(0,0,this.width*this.gridSize,this.height*this.gridSize,15),i.stroke(),i.fill(),i.restore(),i.lineWidth=2;const t=this.gridSize,o=this.width,e=this.height;i.strokeStyle=d.Colors.cellBoarder;for(let s=0;s<e-1;s++)i.beginPath(),i.moveTo(0,s*t+t),i.lineTo(o*t,s*t+t),i.stroke();for(let s=0;s<o-1;s++)i.beginPath(),i.moveTo(s*t+t,0),i.lineTo(s*t+t,e*t),i.stroke();i.restore()}}class I{constructor(i,t){h(this,"image");h(this,"src");h(this,"width");h(this,"height");h(this,"halfHeight");h(this,"halfWidth");h(this,"scale");h(this,"isLoaded");this.src=i,this.scale=t,this.isLoaded=!1,this.image=new Image,this.image.src=i,this.image.onload=()=>this.onload()}onload(){this.image.width*=this.scale,this.image.height*=this.scale,this.width=this.image.width,this.height=this.image.height,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.isLoaded=!0}}function A(r,i){return Math.random()*(i-r)+r}function P({width:r,height:i,gridSize:t}){const o=d.canvas.width,e=o*.5-r*t*.5,s=d.canvas.height,a=s*.5-i*t*.5;let n,g,m=t;do n=A(m,o-m),g=A(m,s-m);while(n+m>e&&n-m<e+r*t&&g+m>a&&g-m<a+i*t);return{x:n,y:g}}class b{constructor(i,t,o){h(this,"position");h(this,"pieceNumber");h(this,"level");h(this,"isLockedInPlace",!1);h(this,"sprite");const e=`${i}/${o}.jpg`;this.sprite=new I(e,.5),this.level=t,this.position=P(t),this.pieceNumber=o}draw(i){i.save(),this.isLockedInPlace||(i.beginPath(),i.roundRect(this.position.x-this.sprite.halfWidth,this.position.y-this.sprite.halfHeight,this.sprite.width,this.sprite.height,10),i.clip()),i.drawImage(this.sprite.image,this.position.x-this.sprite.halfWidth,this.position.y-this.sprite.halfHeight,this.sprite.width,this.sprite.height),i.restore()}}class M{constructor(i,t){h(this,"game");h(this,"width");h(this,"height");h(this,"gridSize");h(this,"pieces");const{width:o,height:e,gridSize:s,path:a}=t;this.game=i,this.width=o,this.height=e,this.gridSize=s,this.pieces=new Array(o*e);for(let g=0;g<this.pieces.length;g++)this.pieces[g]=new b(a,t,g+1);const n=this.pieces[0];this.lockPiece(n,1,1)}checkForSolvedPiece(i){const{x:t,y:o}=i.position,e=this.game.puzzleGrid,s={x:Math.ceil((t-e.position.x)/this.gridSize)*this.gridSize,y:Math.ceil((o-e.position.y)/this.gridSize)*this.gridSize};if(e.getTile(s.x,s.y)!=null)return;let n=!1;const g=e.getTile(s.x,s.y-this.gridSize),m=e.getTile(s.x,s.y+this.gridSize),y=e.getTile(s.x+this.gridSize,s.y),z=e.getTile(s.x-this.gridSize,s.y);if(g?g.pieceNumber==i.pieceNumber-this.width&&(this.lockPiece(i,Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize)),n=!0):m?m.pieceNumber==i.pieceNumber+this.width&&(this.lockPiece(i,Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize)),n=!0):y?y.pieceNumber==i.pieceNumber+1&&(this.lockPiece(i,Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize)),n=!0):z&&z.pieceNumber==i.pieceNumber-1&&(n=!0,this.lockPiece(i,Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize))),n)this.pieces.every(f=>f.isLockedInPlace)&&this.game.onPuzzleSolved();else{const v=i.level,{x:f,y:D}=P(v);i.position.x=f,i.position.y=D}}lockPiece(i,t,o){const e=this.game.puzzleGrid;e.setTile(t*this.gridSize,o*this.gridSize,i),i.position.x=e.position.x+t*this.gridSize-this.gridSize/2,i.position.y=e.position.y+o*this.gridSize-this.gridSize/2,i.isLockedInPlace=!0}isInsideGrid(i){const{x:t,y:o}=i.position,e=this.game.puzzleGrid;return t>e.position.x&&t<e.position.x+e.width*this.gridSize&&o>e.position.y&&o<e.position.y+e.height*this.gridSize}}const R=new I("images/background.png",1);class W{constructor(){h(this,"mouse");h(this,"puzzleGrid");h(this,"pieceCollection");h(this,"holdingPiece");h(this,"holdOffset",{x:0,y:0});h(this,"timestamp",performance.now());h(this,"timeleft");h(this,"gameIsActive",!0);h(this,"totalTime",0);h(this,"levelArray",[]);h(this,"level");this.enterHomepage(),this.resize(),this.mouse=new k,window.addEventListener("resize",()=>this.resize()),document.onkeydown=i=>{i.key==="Escape"&&this.enterHomepage()},this.mouse.onmousedown=()=>this.mousedown(),this.mouse.onmouseup=()=>this.mouseup(),this.loop()}startGame(){this.level=this.levelArray[0],this.puzzleGrid=new S(this.level),this.pieceCollection=new M(this,this.level),this.timeleft=this.level.time,this.gameIsActive=!0}switchLevel(i){this.puzzleGrid=new S(i),this.pieceCollection=new M(this,i)}exitHomepage(){const i=document.querySelector(".start-page");i.style.display="none",this.gameIsActive=!0}enterHomepage(){this.totalTime=0;const i=document.querySelector(".start-page");i.style.display="flex",this.gameIsActive=!1}onPuzzleSolved(){if(this.levelArray.shift(),this.levelArray.length>0)this.startGame();else{const i=Math.floor(this.totalTime/60),t=Math.floor(this.totalTime%60);alert(`Congratulations! You have won the game. Your time was ${i} minutes and ${t} seconds.`),this.enterHomepage()}}loseGame(){alert("You've ran out of time! Try again!"),this.enterHomepage(),this.totalTime=0}loop(){if(requestAnimationFrame(()=>this.loop()),!this.gameIsActive)return;const i=performance.now(),t=(i-this.timestamp)/1e3;this.timestamp=i,this.timeleft-=t,this.totalTime+=t,this.timeleft<=0&&this.loseGame();const o=d.canvas,e=d.ctx;e.fillStyle=d.Colors.background,e.fillRect(0,0,o.width,o.height),R.isLoaded&&(e.save(),e.drawImage(R.image,0,0,o.width,o.height),e.globalAlpha=.8,e.fillRect(0,0,o.width,o.height),e.restore());const s=this.holdingPiece;s&&(s.position.x=this.mouse.x-s.sprite.halfWidth-this.holdOffset.x,s.position.y=this.mouse.y-s.sprite.halfHeight-this.holdOffset.y),this.puzzleGrid.draw(e),this.pieceCollection.pieces.forEach(a=>a.draw(e)),this.drawTime(e)}drawTime(i){const{width:t}=d.canvas;i.fillStyle="#fff",i.font="50px Arial",i.textAlign="center",i.lineWidth=3;const o=Math.floor(this.timeleft/60);let e=Math.floor(this.timeleft%60).toString();Number(e)<10&&(e="0"+e),i.fillText(`${o}:${e}`,t/2,50),i.strokeText(`${o}:${e}`,t/2,50)}resize(){const i=d.canvas;i.width=window.innerWidth,i.height=window.innerHeight}mousedown(){if(!this.gameIsActive)return;const{x:i,y:t}=this.mouse,o=this.pieceCollection.pieces;for(let e=o.length-1;e>=0;e--){const s=o[e];if(s.isLockedInPlace)continue;const a=s.position,n=s.sprite;if(i>a.x-n.halfWidth&&i<a.x+n.halfWidth&&t<a.y+n.halfHeight&&t>a.y-n.halfHeight){this.holdingPiece=s,o.splice(e,1),o.push(s),this.holdOffset.x=i-(a.x+n.halfWidth),this.holdOffset.y=t-(a.y+n.halfHeight);break}}}mouseup(){const i=this.holdingPiece;if(this.holdingPiece=null,i){if(!this.pieceCollection.isInsideGrid(i))return;this.pieceCollection.checkForSolvedPiece(i)}}}let u=0;var l=(r=>(r[r.MASK=u++]="MASK",r[r.MASK_MED=u++]="MASK_MED",r[r.MASK_HARD=u++]="MASK_HARD",r[r.PORTRAIT=u++]="PORTRAIT",r[r.PORTRAIT_MED=u++]="PORTRAIT_MED",r[r.PORTRAIT_HARD=u++]="PORTRAIT_HARD",r[r.SWIRL=u++]="SWIRL",r[r.SWIRL_MED=u++]="SWIRL_MED",r[r.SWIRL_HARD=u++]="SWIRL_HARD",r))(l||{});const p={[l.MASK]:{width:4,height:6,gridSize:75,time:4*6*10,path:"images/mask"},[l.MASK_MED]:{width:4,height:6,gridSize:75,time:4*6*7,path:"images/mask"},[l.MASK_HARD]:{width:4,height:6,gridSize:75,time:4*6*5,path:"images/mask"},[l.PORTRAIT]:{width:6,height:7,gridSize:65,time:6*7*10,path:"images/portrait"},[l.PORTRAIT_MED]:{width:6,height:7,gridSize:65,time:6*7*7,path:"images/portrait"},[l.PORTRAIT_HARD]:{width:6,height:7,gridSize:65,time:6*7*5,path:"images/portrait"},[l.SWIRL]:{width:6,height:8,gridSize:75,time:6*8*10,path:"images/swirl"},[l.SWIRL_MED]:{width:6,height:8,gridSize:75,time:6*8*7,path:"images/swirl"},[l.SWIRL_HARD]:{width:6,height:8,gridSize:75,time:6*8*5,path:"images/swirl"}};var c=new W;function O(){c.levelArray[0]=p[l.MASK],c.levelArray[1]=p[l.PORTRAIT],c.levelArray[2]=p[l.SWIRL],c.exitHomepage(),c.startGame()}function x(){c.levelArray[0]=p[l.MASK_MED],c.levelArray[1]=p[l.PORTRAIT_MED],c.levelArray[2]=p[l.SWIRL_MED],c.exitHomepage(),c.startGame()}function G(){c.levelArray[0]=p[l.MASK_HARD],c.levelArray[1]=p[l.PORTRAIT_HARD],c.levelArray[2]=p[l.SWIRL_HARD],c.exitHomepage(),c.startGame()}document.getElementById("easy").addEventListener("click",O);document.getElementById("medium").addEventListener("click",x);document.getElementById("hard").addEventListener("click",G);
